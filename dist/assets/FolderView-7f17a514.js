import{u as gt,c as dt,H as tt,r as z,a as ft,o as mt,b as pt,d as it,F as et,e as nt,s as ht,f as Dt,S as Rt,E as xt,j as _,D as It,g as Et,h as Mt,i as At,k as _t,l as wt}from"./main-ad2c70ac.js";import{r as n,a as yt}from"./vendor-react-3d7076e0.js";import"./vendor-utils-654bd828.js";const vt=T=>{const{items:E,isEditMode:F,onReorder:b,onDragStart:G,onDragEnd:f,containerRef:y,externalDragItem:M,onDragOut:u,onFolderPlaceholderChange:h}=T,{dragState:a,setDragState:m,placeholderIndex:D,setPlaceholderIndex:v,placeholderRef:R,itemRefs:U,dragRef:g,itemsRef:C,layoutSnapshotRef:S,hasMovedRef:s,thresholdListenerRef:X,startDragging:H,resetPlaceholderState:O,dragElementRef:A,captureLayoutSnapshot:Y,cachedContainerRectRef:c,performHapticFeedback:w}=gt({items:E,isEditMode:F,onDragStart:G,onDragEnd:f,externalDragItem:M,createInitialState:it,resetState:z,containerRef:y}),x=n.useMemo(()=>dt(et),[]);n.useEffect(()=>{D!==null&&a.isDragging&&w(tt.REORDER)},[D,w,a.isDragging]),n.useEffect(()=>(M&&h&&h(D!==null),()=>{h&&h(!1)}),[M,D,h]);const N=n.useRef(null),Z=n.useRef(null),W=n.useRef(null),$=n.useCallback(e=>{const t=g.current;if(t.isDragging&&t.item){const r=e.clientX-t.offset.x,o=e.clientY-t.offset.y;N.current={x:r,y:o},A.current&&(A.current.style.left=`${r}px`,A.current.style.top=`${o}px`);const l=c.current||y.current?.getBoundingClientRect();if(u&&l)if(x.isOutsideContainer?x.isOutsideContainer(e.clientX,e.clientY,l):!1){t.targetAction!=="dragOut"&&(m(I=>({...I,targetAction:"dragOut"})),v(null));return}else t.targetAction==="dragOut"&&m(I=>({...I,targetAction:"reorder"}));const d=x.calculatePlaceholder(e.clientX,e.clientY,S.current,C.current.length,c.current||void 0);v(d)}},[g,C,S,y,m,v,u,x,A,c]),j=n.useCallback(e=>{W.current=e,Z.current===null&&(Z.current=requestAnimationFrame(()=>{Z.current=null;const t=W.current;t&&$(t)}))},[$]);n.useEffect(()=>{if(!M)return;S.current.length===0&&E.length>0&&Y();let e=null,t=null;const r=o=>{t=o,e===null&&(e=requestAnimationFrame(()=>{if(e=null,t){const l=x.calculatePlaceholder(t.clientX,t.clientY,S.current,E.length,c.current||void 0);v(l)}}))};return window.addEventListener("mousemove",r),()=>{window.removeEventListener("mousemove",r),e!==null&&cancelAnimationFrame(e)}},[M,E.length,v,Y,x,c,S]);const L=n.useCallback(()=>{const e=g.current;if(!e.isAnimatingReturn)return;const t=e.targetActionData;if(t)switch(w(tt.DROP),t.type){case"reorder":b(t.newItems);break;case"dragOut":u&&u(t.item,t.mousePosition);break}m(z()),O(),f&&f()},[g,b,u,f,m,O,w]),q=n.useCallback(()=>{const e=g.current,t=R.current??-1;if(window.removeEventListener("mousemove",j),e.isDragging&&e.item){if(e.targetAction==="dragOut"&&u){const r=N.current||e.currentPosition;u(e.item,r),m(z()),O(),f&&f();return}if(t!==-1&&t!==e.originalIndex){const r=y.current,o=r?.getBoundingClientRect();if(o&&r){const l=nt,d=et,p=window.getComputedStyle(r),I=parseFloat(p.paddingLeft)||0,B=parseFloat(p.paddingTop)||0,V=t%d,J=Math.floor(t/d),rt=o.left+I+V*l,ot=o.top+B+J*l,lt=ft(C.current,e.originalIndex,t);m(ut=>({...ut,isDragging:!1,isAnimatingReturn:!0,currentPosition:{x:rt,y:ot},targetPosition:{x:rt,y:ot},targetActionData:{type:"reorder",newItems:lt}})),mt(A.current,()=>{g.current.isAnimatingReturn&&L()});return}}}m(z()),O(),f&&f()},[g,R,y,u,f,m,O,j,L,C,A]),K=n.useCallback((e,t,r)=>{pt({isEditMode:F,item:t,index:r,event:e,setDragState:m,onDragStart:o=>{w(tt.PICKUP),H(o)},handleMouseMove:j,handleMouseUp:q,createDragState:(o,l,d,p,I,B)=>({...it(),isDragging:!0,item:o,originalIndex:l,currentPosition:{x:p,y:I},startPosition:{x:p,y:I},offset:B,targetAction:"reorder"})},s,X)},[F,m,H,j,q,s,X,w]),Q=n.useCallback(e=>{if(D===null)return{x:0,y:0};const t=(a.isDragging||a.isAnimatingReturn)&&a.originalIndex!==-1;return x.calculateTransform(e,D,t?a.originalIndex:M?-1:a.originalIndex,a.isDragging||a.isAnimatingReturn)},[a.isDragging,a.isAnimatingReturn,a.originalIndex,D,M,x]),i=a.targetAction==="dragOut";return{dragState:a,placeholderIndex:D,itemRefs:U,dragElementRef:A,isDraggingOut:i,handleMouseDown:K,getItemTransform:Q}},Ct="_backdrop_1os5g_9",St="_popupWrapper_1os5g_31",Ot="_popover_1os5g_53",Lt="_clickAway_1os5g_67",Pt="_grid_1os5g_83",kt="_container_1os5g_103",Tt="_gridItem_1os5g_147",Ft="_isBeingDragged_1os5g_167",P={backdrop:Ct,popupWrapper:St,popover:Ot,clickAway:Lt,grid:Pt,container:kt,gridItem:Tt,isBeingDragged:Ft},k=et,bt=At,Ht=_t,st=wt,at=nt,ct=nt,jt=({folder:T,isEditMode:E,onItemClick:F,onItemEdit:b,onItemDelete:G,onClose:f,onItemsReorder:y,onItemDragOut:M,anchorRect:u,externalDragItem:h,onDragStart:a,onDragEnd:m,onFolderPlaceholderChange:D,onToggleEditMode:v})=>{const R=n.useRef(null),U=n.useRef(null),[g,C]=n.useState(null),S=n.useCallback((i,e,t,r)=>{C({x:e,y:t,item:i,rect:r})},[]),{dragState:s,isDraggingOut:X,placeholderIndex:H,itemRefs:O,handleMouseDown:A,dragElementRef:Y}=vt({items:T.items||[],isEditMode:E,onReorder:y,onDragOut:M,containerRef:U,externalDragItem:h,onDragStart:a,onDragEnd:m,onFolderPlaceholderChange:D}),c=n.useMemo(()=>T.items||[],[T.items]),w=n.useMemo(()=>{const i={},e=s.originalIndex,t=H,r=(s.isDragging||s.isAnimatingReturn)&&e!==-1;return c.forEach((o,l)=>{let d=l;r&&(l===e?d=-1:l>e&&(d=l-1));let p=d;d!==-1&&t!==null&&d>=t&&(p=d+1),d===-1&&t!==null&&(p=t);const I=p%k,B=Math.floor(p/k),V=I*at,J=B*ct;i[o.id]={x:V,y:J,visualIndex:p}}),i},[c,s.originalIndex,s.isDragging,s.isAnimatingReturn,H]),x=h?c.length+1:c.length,N=h?c.length+1:c.length,W=Math.ceil(Math.max(x,1)/k)*ct-st,$=n.useCallback(()=>{R.current?ht(R.current,300,f):f()},[f]);n.useEffect(()=>{R.current&&Dt(R.current)},[]),n.useEffect(()=>{const i=t=>{const r=t.target;r.closest('[data-dock-container="true"]')||r.closest('[data-modal="true"]')||document.body.classList.contains("is-dragging")||R.current&&!R.current.contains(t.target)&&$()},e=setTimeout(()=>{document.addEventListener("mousedown",i)},100);return()=>{clearTimeout(e),document.removeEventListener("mousedown",i)}},[$]);const L=(Math.min(c.length,k)*64+Math.max(Math.min(c.length,k)-1,0)*8+16)/2,q=n.useMemo(()=>({left:`${Math.min(Math.max(Math.round((u?.left??0)+(u?.width??0)/2),L),window.innerWidth-L)}px`,top:`${Math.round((u?.top??0)-24)}px`}),[u?.left,u?.width,u?.top,L]),K=n.useMemo(()=>({width:Math.min(N,k)*at-st+16,height:"auto",transition:`width ${Rt}ms ${xt}`,pointerEvents:s.isAnimatingReturn?"none":"auto"}),[N,s.isAnimatingReturn]),Q=n.useMemo(()=>({height:W,width:"100%"}),[W]);return c.length===0&&!h?null:yt.createPortal(_.jsxs(_.Fragment,{children:[_.jsx("div",{className:P.popupWrapper,"data-ui-zone":"folder",style:q,onClick:i=>i.stopPropagation(),children:_.jsx("div",{ref:R,className:`${P.container} ${P.popover}`,"data-folder-view":"true","data-ui-zone":"folder",style:K,children:_.jsx("div",{ref:U,className:P.grid,style:Q,children:c.map((i,e)=>{const t=w[i.id]||{x:0,y:0,visualIndex:0},r=(s.isDragging||s.isAnimatingReturn)&&s.item?.id===i.id;return _.jsx("div",{ref:o=>{O.current[e]=o},className:`${P.gridItem} ${r?P.isBeingDragged:""}`,style:{width:bt,height:Ht,transform:`translate3d(${t.x}px, ${t.y}px, 0)`},children:_.jsx(It,{item:i,isEditMode:E,onClick:()=>F(i),onEdit:o=>b(i,o),onDelete:()=>G(i),isDragging:r,staggerIndex:e,onMouseDown:o=>A(o,i,e),onContextMenu:(o,l,d)=>S(i,o,l,d)})},i.id)})})})}),_.jsx(Et,{isActive:s.isDragging||s.isAnimatingReturn,item:s.item,position:s.currentPosition,isAnimatingReturn:s.isAnimatingReturn,isEditMode:E,dragElementRef:Y,isDraggingOut:X}),g&&_.jsx(Mt,{x:g.x,y:g.y,item:g.item,isEditMode:E,onClose:()=>C(null),onEdit:()=>b(g.item,g.rect),onToggleEditMode:()=>v?.(),onDelete:()=>G(g.item)})]}),document.body)};export{jt as FolderView};
