import{u as gt,r as s,c as dt,H as tt,a as K,b as ft,o as mt,d as pt,e as it,F as et,f as nt,s as Dt,S as xt,E as It,g as ht,j as M,D as Et,h as At,i as _t,k as wt,l as yt,m as Mt,n as vt}from"./main-b3bd7de1.js";const Ct=j=>{const{items:E,isEditMode:T,onReorder:b,onDragStart:B,onDragEnd:p,containerRef:v,externalDragItem:A,onDragOut:n,onFolderPlaceholderChange:D}=j,{dragState:u,setDragState:m,placeholderIndex:x,setPlaceholderIndex:_,placeholderRef:I,itemRefs:G,dragRef:d,itemsRef:C,layoutSnapshotRef:O,hasMovedRef:a,thresholdListenerRef:U,startDragging:H,resetPlaceholderState:R,dragElementRef:w,captureLayoutSnapshot:X,cachedContainerRectRef:c,performHapticFeedback:L}=gt({items:E,isEditMode:T,onDragStart:B,onDragEnd:p,externalDragItem:A,createInitialState:it,resetState:K,containerRef:v}),h=s.useMemo(()=>dt(et),[]);s.useEffect(()=>{x!==null&&u.isDragging&&L(tt.REORDER)},[x,L,u.isDragging]),s.useEffect(()=>(A&&D&&D(x!==null),()=>{D&&D(!1)}),[A,x,D]);const N=s.useRef(null),Y=s.useRef(null),W=s.useRef(null),Z=s.useCallback(e=>{var r;const t=d.current;if(t.isDragging&&t.item){const l=e.clientX-t.offset.x,i=e.clientY-t.offset.y;N.current={x:l,y:i},w.current&&(w.current.style.left=`${l}px`,w.current.style.top=`${i}px`);const g=c.current||((r=v.current)==null?void 0:r.getBoundingClientRect());if(n&&g)if(h.isOutsideContainer?h.isOutsideContainer(e.clientX,e.clientY,g):!1){t.targetAction!=="dragOut"&&(m(y=>({...y,targetAction:"dragOut"})),_(null));return}else t.targetAction==="dragOut"&&m(y=>({...y,targetAction:"reorder"}));const f=h.calculatePlaceholder(e.clientX,e.clientY,O.current,C.current.length,c.current||void 0);_(f)}},[d,C,O,v,m,_,n,h,w,c]),$=s.useCallback(e=>{W.current=e,Y.current===null&&(Y.current=requestAnimationFrame(()=>{Y.current=null;const t=W.current;t&&Z(t)}))},[Z]);s.useEffect(()=>{if(!A)return;O.current.length===0&&E.length>0&&X();let e=null,t=null;const r=l=>{t=l,e===null&&(e=requestAnimationFrame(()=>{if(e=null,t){const i=h.calculatePlaceholder(t.clientX,t.clientY,O.current,E.length,c.current||void 0);_(i)}}))};return window.addEventListener("mousemove",r),()=>{window.removeEventListener("mousemove",r),e!==null&&cancelAnimationFrame(e)}},[A,E.length,_,X,h,c]);const P=s.useCallback(()=>{const e=d.current;if(!e.isAnimatingReturn)return;const t=e.targetActionData;if(t)switch(L(tt.DROP),t.type){case"reorder":b(t.newItems);break;case"dragOut":n&&n(t.item,t.mousePosition);break}m(K()),R(),p&&p()},[d,b,n,p,m,R]),q=s.useCallback(()=>{const e=d.current,t=I.current??-1;if(window.removeEventListener("mousemove",$),e.isDragging&&e.item){if(e.targetAction==="dragOut"&&n){const r=N.current||e.currentPosition;n(e.item,r),m(K()),R(),p&&p();return}if(t!==-1&&t!==e.originalIndex){const r=v.current,l=r==null?void 0:r.getBoundingClientRect();if(l&&r){const i=nt,g=et,f=window.getComputedStyle(r),S=parseFloat(f.paddingLeft)||0,y=parseFloat(f.paddingTop)||0,z=t%g,J=Math.floor(t/g),rt=l.left+S+z*i,st=l.top+y+J*i,ut=ft(C.current,e.originalIndex,t);m(ct=>({...ct,isDragging:!1,isAnimatingReturn:!0,currentPosition:{x:rt,y:st},targetPosition:{x:rt,y:st},targetActionData:{type:"reorder",newItems:ut}})),mt(w.current,()=>{d.current.isAnimatingReturn&&P()});return}}}m(K()),R(),p&&p()},[d,I,v,n,p,m,R,$,P,C,w]),Q=s.useCallback((e,t,r)=>{pt({isEditMode:T,item:t,index:r,event:e,setDragState:m,onDragStart:l=>{L(tt.PICKUP),H(l)},handleMouseMove:$,handleMouseUp:q,createDragState:(l,i,g,f,S,y)=>({...it(),isDragging:!0,item:l,originalIndex:i,currentPosition:{x:f,y:S},startPosition:{x:f,y:S},offset:y,targetAction:"reorder"})},a,U)},[T,m,H,$,q,a,U]),V=s.useCallback(e=>{if(x===null)return{x:0,y:0};const t=(u.isDragging||u.isAnimatingReturn)&&u.originalIndex!==-1;return h.calculateTransform(e,x,t?u.originalIndex:A?-1:u.originalIndex,u.isDragging||u.isAnimatingReturn)},[u.isDragging,u.isAnimatingReturn,u.originalIndex,x,A,h]),o=u.targetAction==="dragOut";return{dragState:u,placeholderIndex:x,itemRefs:G,dragElementRef:w,isDraggingOut:o,handleMouseDown:Q,getItemTransform:V}},Rt="_backdrop_1os5g_9",St="_popupWrapper_1os5g_31",Ot="_popover_1os5g_53",Lt="_clickAway_1os5g_67",Pt="_grid_1os5g_83",kt="_container_1os5g_103",Ft="_gridItem_1os5g_147",Tt="_isBeingDragged_1os5g_167",k={backdrop:Rt,popupWrapper:St,popover:Ot,clickAway:Lt,grid:Pt,container:kt,gridItem:Ft,isBeingDragged:Tt},F=et,bt=wt,Ht=yt,ot=Mt,at=nt,lt=nt,Wt=({folder:j,isEditMode:E,onItemClick:T,onItemEdit:b,onItemDelete:B,onClose:p,onItemsReorder:v,onItemDragOut:A,anchorRect:n,externalDragItem:D,onDragStart:u,onDragEnd:m,onFolderPlaceholderChange:x,onToggleEditMode:_})=>{const I=s.useRef(null),G=s.useRef(null),[d,C]=s.useState(null),O=s.useCallback((o,e,t,r)=>{C({x:e,y:t,item:o,rect:r})},[]),{dragState:a,isDraggingOut:U,placeholderIndex:H,itemRefs:R,handleMouseDown:w,dragElementRef:X}=Ct({items:j.items||[],isEditMode:E,onReorder:v,onDragOut:A,containerRef:G,externalDragItem:D,onDragStart:u,onDragEnd:m,onFolderPlaceholderChange:x}),c=j.items||[],L=s.useMemo(()=>{const o={},e=a.originalIndex,t=H,r=(a.isDragging||a.isAnimatingReturn)&&e!==-1;return c.forEach((l,i)=>{let g=i;r&&(i===e?g=-1:i>e&&(g=i-1));let f=g;g!==-1&&t!==null&&g>=t&&(f=g+1),g===-1&&t!==null&&(f=t);const S=f%F,y=Math.floor(f/F),z=S*at,J=y*lt;o[l.id]={x:z,y:J,visualIndex:f}}),o},[c,a.originalIndex,a.isDragging,a.isAnimatingReturn,H,D]),h=D?c.length+1:c.length,N=D?c.length+1:c.length,W=Math.ceil(Math.max(h,1)/F)*lt-ot;s.useEffect(()=>{I.current&&Dt(I.current)},[]),s.useEffect(()=>{const o=t=>{const r=t.target;r.closest('[data-dock-container="true"]')||r.closest('[data-modal="true"]')||document.body.classList.contains("is-dragging")||I.current&&!I.current.contains(t.target)&&Z()},e=setTimeout(()=>{document.addEventListener("mousedown",o)},100);return()=>{clearTimeout(e),document.removeEventListener("mousedown",o)}},[]);const Z=()=>{I.current?vt(I.current,300,p):p()};if(c.length===0&&!D)return null;const P=(Math.min(c.length,F)*64+Math.max(Math.min(c.length,F)-1,0)*8+16)/2,q=s.useMemo(()=>({left:`${Math.min(Math.max(Math.round(((n==null?void 0:n.left)??0)+((n==null?void 0:n.width)??0)/2),P),window.innerWidth-P)}px`,top:`${Math.round(((n==null?void 0:n.top)??0)-24)}px`}),[n==null?void 0:n.left,n==null?void 0:n.width,n==null?void 0:n.top,P]),Q=s.useMemo(()=>({width:Math.min(N,F)*at-ot+16,height:"auto",transition:`width ${xt}ms ${It}`,pointerEvents:a.isAnimatingReturn?"none":"auto"}),[N,a.isAnimatingReturn]),V=s.useMemo(()=>({height:W,width:"100%"}),[W]);return ht.createPortal(M.jsxs(M.Fragment,{children:[M.jsx("div",{className:k.popupWrapper,style:q,onClick:o=>o.stopPropagation(),children:M.jsx("div",{ref:I,className:`${k.container} ${k.popover}`,"data-folder-view":"true",style:Q,children:M.jsx("div",{ref:G,className:k.grid,style:V,children:c.map((o,e)=>{var l;const t=L[o.id]||{x:0,y:0,visualIndex:0},r=(a.isDragging||a.isAnimatingReturn)&&((l=a.item)==null?void 0:l.id)===o.id;return M.jsx("div",{ref:i=>{R.current[e]=i},className:`${k.gridItem} ${r?k.isBeingDragged:""}`,style:{width:bt,height:Ht,transform:`translate3d(${t.x}px, ${t.y}px, 0)`},children:M.jsx(Et,{item:o,isEditMode:E,onClick:()=>T(o),onEdit:i=>b(o,i),onDelete:()=>B(o),isDragging:r,staggerIndex:e,onMouseDown:i=>w(i,o,e),onContextMenu:(i,g,f)=>O(o,i,g,f)})},o.id)})})})}),M.jsx(At,{isActive:a.isDragging||a.isAnimatingReturn,item:a.item,position:a.currentPosition,isAnimatingReturn:a.isAnimatingReturn,isEditMode:E,dragElementRef:X,isDraggingOut:U}),d&&M.jsx(_t,{x:d.x,y:d.y,item:d.item,isEditMode:E,onClose:()=>C(null),onEdit:()=>b(d.item,d.rect),onToggleEditMode:()=>_==null?void 0:_(),onDelete:()=>B(d.item)})]}),document.body)};export{Wt as FolderView};
