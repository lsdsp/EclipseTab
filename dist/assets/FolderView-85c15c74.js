import{u as gt,c as dt,H as tt,r as K,a as ft,o as mt,b as pt,d as it,F as et,e as nt,s as ht,S as Dt,E as Rt,j as _,D as xt,f as It,g as Et,h as At,i as Mt,k as _t,l as wt}from"./main-bdd73ef2.js";import{r,a as yt}from"./vendor-react-d96b9a5d.js";import"./vendor-utils-654bd828.js";const vt=j=>{const{items:E,isEditMode:T,onReorder:F,onDragStart:B,onDragEnd:m,containerRef:w,externalDragItem:A,onDragOut:u,onFolderPlaceholderChange:h}=j,{dragState:a,setDragState:f,placeholderIndex:D,setPlaceholderIndex:y,placeholderRef:R,itemRefs:G,dragRef:g,itemsRef:v,layoutSnapshotRef:S,hasMovedRef:s,thresholdListenerRef:U,startDragging:b,resetPlaceholderState:C,dragElementRef:M,captureLayoutSnapshot:X,cachedContainerRectRef:c,performHapticFeedback:O}=gt({items:E,isEditMode:T,onDragStart:B,onDragEnd:m,externalDragItem:A,createInitialState:it,resetState:K,containerRef:w}),x=r.useMemo(()=>dt(et),[]);r.useEffect(()=>{D!==null&&a.isDragging&&O(tt.REORDER)},[D,O,a.isDragging]),r.useEffect(()=>(A&&h&&h(D!==null),()=>{h&&h(!1)}),[A,D,h]);const H=r.useRef(null),Y=r.useRef(null),N=r.useRef(null),Z=r.useCallback(e=>{const t=g.current;if(t.isDragging&&t.item){const n=e.clientX-t.offset.x,o=e.clientY-t.offset.y;H.current={x:n,y:o},M.current&&(M.current.style.left=`${n}px`,M.current.style.top=`${o}px`);const l=c.current||w.current?.getBoundingClientRect();if(u&&l)if(x.isOutsideContainer?x.isOutsideContainer(e.clientX,e.clientY,l):!1){t.targetAction!=="dragOut"&&(f(I=>({...I,targetAction:"dragOut"})),y(null));return}else t.targetAction==="dragOut"&&f(I=>({...I,targetAction:"reorder"}));const d=x.calculatePlaceholder(e.clientX,e.clientY,S.current,v.current.length,c.current||void 0);y(d)}},[g,v,S,w,f,y,u,x,M,c]),W=r.useCallback(e=>{N.current=e,Y.current===null&&(Y.current=requestAnimationFrame(()=>{Y.current=null;const t=N.current;t&&Z(t)}))},[Z]);r.useEffect(()=>{if(!A)return;S.current.length===0&&E.length>0&&X();let e=null,t=null;const n=o=>{t=o,e===null&&(e=requestAnimationFrame(()=>{if(e=null,t){const l=x.calculatePlaceholder(t.clientX,t.clientY,S.current,E.length,c.current||void 0);y(l)}}))};return window.addEventListener("mousemove",n),()=>{window.removeEventListener("mousemove",n),e!==null&&cancelAnimationFrame(e)}},[A,E.length,y,X,x,c]);const L=r.useCallback(()=>{const e=g.current;if(!e.isAnimatingReturn)return;const t=e.targetActionData;if(t)switch(O(tt.DROP),t.type){case"reorder":F(t.newItems);break;case"dragOut":u&&u(t.item,t.mousePosition);break}f(K()),C(),m&&m()},[g,F,u,m,f,C]),q=r.useCallback(()=>{const e=g.current,t=R.current??-1;if(window.removeEventListener("mousemove",W),e.isDragging&&e.item){if(e.targetAction==="dragOut"&&u){const n=H.current||e.currentPosition;u(e.item,n),f(K()),C(),m&&m();return}if(t!==-1&&t!==e.originalIndex){const n=w.current,o=n?.getBoundingClientRect();if(o&&n){const l=nt,d=et,p=window.getComputedStyle(n),I=parseFloat(p.paddingLeft)||0,$=parseFloat(p.paddingTop)||0,z=t%d,J=Math.floor(t/d),rt=o.left+I+z*l,ot=o.top+$+J*l,lt=ft(v.current,e.originalIndex,t);f(ut=>({...ut,isDragging:!1,isAnimatingReturn:!0,currentPosition:{x:rt,y:ot},targetPosition:{x:rt,y:ot},targetActionData:{type:"reorder",newItems:lt}})),mt(M.current,()=>{g.current.isAnimatingReturn&&L()});return}}}f(K()),C(),m&&m()},[g,R,w,u,m,f,C,W,L,v,M]),Q=r.useCallback((e,t,n)=>{pt({isEditMode:T,item:t,index:n,event:e,setDragState:f,onDragStart:o=>{O(tt.PICKUP),b(o)},handleMouseMove:W,handleMouseUp:q,createDragState:(o,l,d,p,I,$)=>({...it(),isDragging:!0,item:o,originalIndex:l,currentPosition:{x:p,y:I},startPosition:{x:p,y:I},offset:$,targetAction:"reorder"})},s,U)},[T,f,b,W,q,s,U]),V=r.useCallback(e=>{if(D===null)return{x:0,y:0};const t=(a.isDragging||a.isAnimatingReturn)&&a.originalIndex!==-1;return x.calculateTransform(e,D,t?a.originalIndex:A?-1:a.originalIndex,a.isDragging||a.isAnimatingReturn)},[a.isDragging,a.isAnimatingReturn,a.originalIndex,D,A,x]),i=a.targetAction==="dragOut";return{dragState:a,placeholderIndex:D,itemRefs:G,dragElementRef:M,isDraggingOut:i,handleMouseDown:Q,getItemTransform:V}},Ct="_backdrop_1os5g_9",St="_popupWrapper_1os5g_31",Ot="_popover_1os5g_53",Lt="_clickAway_1os5g_67",Pt="_grid_1os5g_83",kt="_container_1os5g_103",Tt="_gridItem_1os5g_147",Ft="_isBeingDragged_1os5g_167",P={backdrop:Ct,popupWrapper:St,popover:Ot,clickAway:Lt,grid:Pt,container:kt,gridItem:Tt,isBeingDragged:Ft},k=et,bt=At,Ht=Mt,st=_t,at=nt,ct=nt,jt=({folder:j,isEditMode:E,onItemClick:T,onItemEdit:F,onItemDelete:B,onClose:m,onItemsReorder:w,onItemDragOut:A,anchorRect:u,externalDragItem:h,onDragStart:a,onDragEnd:f,onFolderPlaceholderChange:D,onToggleEditMode:y})=>{const R=r.useRef(null),G=r.useRef(null),[g,v]=r.useState(null),S=r.useCallback((i,e,t,n)=>{v({x:e,y:t,item:i,rect:n})},[]),{dragState:s,isDraggingOut:U,placeholderIndex:b,itemRefs:C,handleMouseDown:M,dragElementRef:X}=vt({items:j.items||[],isEditMode:E,onReorder:w,onDragOut:A,containerRef:G,externalDragItem:h,onDragStart:a,onDragEnd:f,onFolderPlaceholderChange:D}),c=j.items||[],O=r.useMemo(()=>{const i={},e=s.originalIndex,t=b,n=(s.isDragging||s.isAnimatingReturn)&&e!==-1;return c.forEach((o,l)=>{let d=l;n&&(l===e?d=-1:l>e&&(d=l-1));let p=d;d!==-1&&t!==null&&d>=t&&(p=d+1),d===-1&&t!==null&&(p=t);const I=p%k,$=Math.floor(p/k),z=I*at,J=$*ct;i[o.id]={x:z,y:J,visualIndex:p}}),i},[c,s.originalIndex,s.isDragging,s.isAnimatingReturn,b,h]),x=h?c.length+1:c.length,H=h?c.length+1:c.length,N=Math.ceil(Math.max(x,1)/k)*ct-st;r.useEffect(()=>{R.current&&ht(R.current)},[]),r.useEffect(()=>{const i=t=>{const n=t.target;n.closest('[data-dock-container="true"]')||n.closest('[data-modal="true"]')||document.body.classList.contains("is-dragging")||R.current&&!R.current.contains(t.target)&&Z()},e=setTimeout(()=>{document.addEventListener("mousedown",i)},100);return()=>{clearTimeout(e),document.removeEventListener("mousedown",i)}},[]);const Z=()=>{R.current?wt(R.current,300,m):m()};if(c.length===0&&!h)return null;const L=(Math.min(c.length,k)*64+Math.max(Math.min(c.length,k)-1,0)*8+16)/2,q=r.useMemo(()=>({left:`${Math.min(Math.max(Math.round((u?.left??0)+(u?.width??0)/2),L),window.innerWidth-L)}px`,top:`${Math.round((u?.top??0)-24)}px`}),[u?.left,u?.width,u?.top,L]),Q=r.useMemo(()=>({width:Math.min(H,k)*at-st+16,height:"auto",transition:`width ${Dt}ms ${Rt}`,pointerEvents:s.isAnimatingReturn?"none":"auto"}),[H,s.isAnimatingReturn]),V=r.useMemo(()=>({height:N,width:"100%"}),[N]);return yt.createPortal(_.jsxs(_.Fragment,{children:[_.jsx("div",{className:P.popupWrapper,style:q,onClick:i=>i.stopPropagation(),children:_.jsx("div",{ref:R,className:`${P.container} ${P.popover}`,"data-folder-view":"true",style:Q,children:_.jsx("div",{ref:G,className:P.grid,style:V,children:c.map((i,e)=>{const t=O[i.id]||{x:0,y:0,visualIndex:0},n=(s.isDragging||s.isAnimatingReturn)&&s.item?.id===i.id;return _.jsx("div",{ref:o=>{C.current[e]=o},className:`${P.gridItem} ${n?P.isBeingDragged:""}`,style:{width:bt,height:Ht,transform:`translate3d(${t.x}px, ${t.y}px, 0)`},children:_.jsx(xt,{item:i,isEditMode:E,onClick:()=>T(i),onEdit:o=>F(i,o),onDelete:()=>B(i),isDragging:n,staggerIndex:e,onMouseDown:o=>M(o,i,e),onContextMenu:(o,l,d)=>S(i,o,l,d)})},i.id)})})})}),_.jsx(It,{isActive:s.isDragging||s.isAnimatingReturn,item:s.item,position:s.currentPosition,isAnimatingReturn:s.isAnimatingReturn,isEditMode:E,dragElementRef:X,isDraggingOut:U}),g&&_.jsx(Et,{x:g.x,y:g.y,item:g.item,isEditMode:E,onClose:()=>v(null),onEdit:()=>F(g.item,g.rect),onToggleEditMode:()=>y?.(),onDelete:()=>B(g.item)})]}),document.body)};export{jt as FolderView};
