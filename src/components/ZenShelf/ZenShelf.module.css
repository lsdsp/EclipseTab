/* ===== Zen Shelf 画布样式 ===== */

/* 画布容器 - 位于壁纸与 UI 之间 */
.canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    isolation: isolate;
    /* Ensure stickers stay within this stacking context */
    pointer-events: none;
    /* 默认透传指针事件 */
    overflow: hidden;
}

.canvas.dragging {
    /* Lift canvas above Recycle Bin (2500) during drag */
    z-index: 2501;
}

/* 创作模式下的画布 - 不阻挡 UI 层 */
.canvas.creativeMode {
    /* 注意：不设置 pointer-events: auto，让贴纸自己接收事件 */
    /* 画布只在点击空白处时接收事件，通过 JS 控制 */
    cursor: crosshair;
}

/* ===== 贴纸基础样式 ===== */

/* 贴纸通用样式 - 核心贴纸效果 */
/* 使用 SVG filter 实现纯白无模糊描边 + 模糊阴影 */
.sticker {
    position: absolute;
    pointer-events: auto;
    cursor: grab;
    user-select: none;
    /* GPU 加速提示 */
    will-change: transform;
    /* 性能优化：限制布局和样式计算范围 */
    contain: layout style;
}

/* 文字贴纸外层容器 - 用于阴影动画 */
/* 阴影放在外层是因为 CSS filter 的 url() 无法与 drop-shadow() 一起动画 */
.stickerText {
    /* 默认投影 - 较浅 */
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.08));
    /* 阴影平滑过渡 */
    transition: filter var(--transition-smooth);
}

/* 文字贴纸外层 - 拖拽/按下中的阴影 */
.stickerText.dragging {
    filter: drop-shadow(0 12px 24px rgba(0, 0, 0, 0.2));
}

/* 创作模式下悬停效果 - 文字贴纸外层 */
.stickerText.creativeHover:hover {
    filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.12));
}

/* 文字贴纸的白色轮廓 - 使用 SVG filter 实现平滑描边 */
/* 见下方 .textSticker 样式定义 */

/* 图片贴纸的轮廓 - 通过 outline 实现，颜色与文字贴纸描边一致 */
.imageSticker {
    outline: 6px solid var(--color-sticker-stroke);
    outline-offset: 0;
    /* 默认投影 - 较浅 */
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.08));
    /* 阴影平滑过渡 */
    transition: filter var(--transition-smooth), outline-color var(--transition-smooth);
}

/* 拖拽/按下中的样式 - 文字贴纸内层只保留描边 */
.textSticker.dragging {
    cursor: grabbing;
    will-change: transform, left, top;
}

/* 拖拽/按下中的样式 - 图片贴纸 */
.imageSticker.dragging {
    cursor: grabbing;
    /* 加深阴影，增大模糊值 */
    filter: drop-shadow(0 12px 24px rgba(0, 0, 0, 0.2));
    /* 保持阴影过渡动画 */
    transition: filter var(--transition-smooth);
    will-change: transform, left, top, filter;
}

/* 回弹动画 - 贴纸从UI区域弹回安全区域 */
.sticker.bounceBack {
    transition: left 0.35s cubic-bezier(0.34, 1.56, 0.64, 1),
        top 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* 创作模式下悬停效果 - 文字贴纸内层不需要修改 */
/* 阴影变化由外层 .stickerText.creativeHover:hover 处理 */

/* 创作模式下悬停效果 - 图片贴纸 */
.imageSticker.creativeHover:hover {
    filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.12));
}

/* 选中态 */
.sticker.selected {
    outline: 2px dashed var(--blue-500);
    outline-offset: 8px;
}

/* ===== 文字贴纸 ===== */

.textSticker {
    padding: var(--spacing-padding-medium) var(--spacing-padding-large);
    background: transparent;
    font-family: var(--font-family);
    font-size: 40px;
    font-weight: 900;
    /* 紧凑行间距 */
    line-height: 0.95;
    /* 紧凑字间距 (0.9 效果) */
    letter-spacing: -0.05em;
    white-space: pre;
    min-width: 60px;
    /* Firefox 文本渲染优化 */
    text-rendering: geometricPrecision;
    -moz-text-size-adjust: none;
    -webkit-text-size-adjust: none;
    text-size-adjust: none;
    /* SVG filter 描边 (阴影由外层 .stickerText 处理) */
    filter: url(#text-sticker-stroke);
}

/* 普通字体：保持白边风格，降低默认粗重感 */
.textStickerNormal {
    font-weight: 600;
    letter-spacing: -0.01em;
    line-height: 1;
}

/* 代码字体：保持白边风格不变，降低粗重感并优化中英混排观感 */
.textStickerCode {
    font-weight: 700;
    letter-spacing: -0.01em;
    line-height: 1;
}

/* Firefox 专用样式 - 使用 -moz-appearance 检测 Firefox */
@supports (-moz-appearance: none) {
    .textSticker {
        -webkit-text-stroke: 0.3px currentColor;
        line-height: 0.85;
    }

    .textStickerNormal {
        -webkit-text-stroke: 0.2px currentColor;
        line-height: 0.95;
    }

    .textStickerCode {
        -webkit-text-stroke: 0.2px currentColor;
        line-height: 0.95;
    }
}

/* ===== 图片贴纸 ===== */

.imageSticker {
    display: block;
    max-width: none;
    height: auto;
    border-radius: var(--radius-medium);
}

/* 图片容器 - 用于定位缩放手柄 */
.imageContainer {
    position: relative;
    display: inline-block;
}

/* ===== 缩放手柄 ===== */

.resizeHandle {
    position: absolute;
    bottom: -4px;
    right: -4px;
    width: 16px;
    height: 16px;
    background: var(--white);
    border: 2px solid var(--gray-400);
    border-radius: var(--spacing-border-default);
    cursor: nwse-resize;
    opacity: 0;
    transition: opacity var(--transition-fast);
    z-index: 10;
    pointer-events: auto;
}

.sticker:hover .resizeHandle {
    opacity: 1;
}

.resizeHandle:hover {
    border-color: var(--blue-500);
    background: var(--blue-100, #E3F2FD);
}


/* ===== 删除按钮 ===== */

.deleteButton {
    position: absolute;
    top: -8px;
    right: -8px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--red-500);
    color: white;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    opacity: 0;
    transform: scale(0.8);
    transition: opacity var(--transition-fast), transform var(--transition-fast);
    z-index: 10;
    pointer-events: auto;
}

.sticker:hover .deleteButton,
.deleteButton:focus {
    opacity: 1;
    transform: scale(1);
}

.deleteButton:hover {
    background: var(--red-400);
}

/* ===== 文字输入弹窗 ===== */

.textInputPopup {
    position: fixed;
    z-index: 3000;
    backdrop-filter: blur(24px);
    -webkit-backdrop-filter: blur(24px);
    background: var(--color-bg-primary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-default);
    box-shadow: var(--shadow-combined);
    padding: var(--spacing-padding-extrasmall);
    display: flex;
    flex-direction: column;
    gap: 4px;
    pointer-events: auto;
}

/* 内层容器 */
.textInputInner {
    background: var(--color-bg-secondary);
    box-shadow: var(--shadow-small);
    border-radius: var(--radius-default-in);
    padding: var(--spacing-padding-small);
    display: flex;
    flex-direction: column;
    gap: 8px;
    width: 320px;
}

/* 标签文本 */
.textInputLabel {
    font-family: var(--font-family);
    font-weight: var(--font-weight-medium);
    font-size: var(--font-size-small);
    line-height: var(--line-height-none);
    color: var(--color-text-primary);
    opacity: 0.6;
}

/* 输入区域 */
.textInput {
    width: 100%;
    min-height: 80px;
    max-height: 200px;
    padding: var(--spacing-padding-small);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-small);
    color: var(--color-text-primary);
    font-family: var(--font-family);
    font-size: var(--font-size-medium);
    font-weight: var(--font-weight-medium);
    outline: none;
    resize: vertical;
    transition: border-color var(--transition-medium), background var(--transition-medium);
    box-sizing: border-box;
}

.textInput:focus {
    background: var(--color-bg-tertiary);
    border-color: var(--blue-500);
}

.textInput::placeholder {
    color: var(--color-text-secondary);
}

/* 样式选项区域 */
.styleOptionsSection {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

/* 对齐按钮组 */
.alignmentGroup {
    background: var(--color-bg-secondary);
    box-shadow: var(--shadow-small);
    border-radius: var(--radius-small);
    padding: var(--spacing-padding-extrasmall);
    padding: 4px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0;
    position: relative;
    isolation: isolate;
}

.highlightBackground {
    position: absolute;
    left: 4px;
    top: 4px;
    bottom: 4px;
    width: calc((100% - 8px) / 3);
    background: var(--color-bg-primary);
    border-radius: 4px;
    transition: transform var(--transition-smooth);
    z-index: 0;
    box-shadow: var(--shadow-small);
}

.alignmentButton {
    flex: 1;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    border-radius: 4px;
    /* Local specific overrides allowed but variable preferred */
    border-radius: var(--radius-small);
    cursor: pointer;
    color: var(--color-text-primary);
    transition: color var(--transition-fast);
    z-index: 1;
}

/* Active state handled by sliding background */
/* .alignmentButton.active { } */

/* 颜色选项网格 */
.colorOptionsGrid {
    background: var(--color-bg-secondary);
    box-shadow: var(--shadow-small);
    border-radius: var(--radius-small);
    padding: var(--spacing-padding-extrasmall);
    display: flex;
    gap: 4px;
}

.colorOptionBtn {
    flex: 1;
    height: 32px;
    border-radius: var(--radius-small);
    border: 1px solid transparent;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.colorOptionBtn:hover {
    transform: scale(1.05);
}

.colorOptionBtn.active {
    border-color: var(--blue-500);
    box-shadow: 0 0 0 1px var(--blue-500);
}

/* 底部操作按钮 */
.textInputActions {
    display: flex;
    gap: 8px;
    margin-top: 4px;
}

.textInputCancel {
    flex: 1;
    padding: var(--spacing-padding-small);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-small);
    color: var(--color-text-primary);
    font-family: var(--font-family);
    font-size: var(--font-size-medium);
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    transition: background var(--transition-medium);
}

.textInputCancel:hover {
    background: var(--color-bg-tertiary);
}

.textInputConfirm {
    flex: 1;
    padding: var(--spacing-padding-small);
    background: var(--blue-500);
    border: none;
    border-radius: var(--radius-small);
    color: white;
    font-family: var(--font-family);
    font-size: var(--font-size-medium);
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    transition: background var(--transition-medium), opacity var(--transition-medium);
}

.textInputConfirm:hover {
    background: var(--blue-400);
}

.textInputConfirm:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

/* ===== 浮动工具栏 ===== */

.floatingToolbar {
    position: absolute;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    background: var(--color-bg-secondary);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--color-border);
    border-radius: 24px;
    box-shadow: var(--shadow-combined);
    z-index: 200;
    pointer-events: auto;
}

/* 工具栏分隔线 */
.toolbarDivider {
    width: 1px;
    height: 16px;
    background: var(--color-border);
}

/* 对齐按钮 */
.alignButton {
    width: 28px;
    height: 28px;
    border: none;
    background: transparent;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-text-primary);
    transition: background var(--transition-fast);
}

.alignButton:hover {
    background: var(--color-bg-tertiary);
}

.alignButton.active {
    background: var(--blue-500);
    color: white;
}

/* 颜色选择器 */
.colorButton {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 2px solid transparent;
    cursor: pointer;
    transition: transform var(--transition-fast), border-color var(--transition-fast);
}

.colorButton:hover {
    transform: scale(1.15);
}

.colorButton.active {
    border-color: var(--blue-500);
}

/* ===== 右键菜单 ===== */
/* 样式参考 SpaceManageMenu */

.contextMenu {
    position: fixed;
    z-index: 3000;
    backdrop-filter: blur(24px);
    -webkit-backdrop-filter: blur(24px);
    background: var(--color-bg-primary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-default);
    padding: var(--spacing-padding-small);
    display: flex;
    flex-direction: column;
    min-width: 180px;
    gap: 0;
    pointer-events: auto;
    box-shadow: var(--shadow-combined);
}

/* 菜单标签 */
.menuLabel {
    font-family: var(--font-family);
    font-weight: var(--font-weight-medium);
    font-size: var(--font-size-small);
    padding: var(--spacing-padding-extrasmall);
    line-height: var(--line-height-none);
    color: var(--color-text-primary);
    opacity: 0.6;
    white-space: nowrap;
    margin: 0;
}

/* 菜单分隔线 */
.menuDivider {
    width: 100%;
    height: 0;
    padding: var(--spacing-padding-extrasmall);
    position: relative;
    margin: 0;
}

.menuDivider::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    height: 1px;
    background: var(--color-border);
}

/* 菜单选项容器 */
.menuOptions {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-top: 4px;
}

/* 菜单项 */
.menuItem {
    background: none;
    border: none;
    padding: var(--spacing-padding-small);
    font-family: var(--font-family);
    font-weight: var(--font-weight-medium);
    font-size: var(--font-size-medium);
    line-height: var(--line-height-none);
    color: var(--color-text-primary);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: var(--spacing-gap-small);
    text-align: left;
    white-space: nowrap;
    transition: opacity var(--transition-medium), background var(--transition-medium);
    opacity: 1;
    margin: 0;
    border-radius: var(--radius-small);
}

.menuItem:hover {
    opacity: 0.85;
    background: var(--color-bg-secondary);
}

.menuItem:active {
    background: var(--color-bg-tertiary);
}

/* 危险操作 (删除) */
.menuItem.danger {
    color: var(--red-400);
}

.menuItem.danger:hover {
    background: rgba(255, 107, 107, 0.1);
}

/* 菜单图标 */
.menuIcon {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
    background-color: var(--color-text-primary);
    -webkit-mask-size: contain;
    mask-size: contain;
    -webkit-mask-repeat: no-repeat;
    mask-repeat: no-repeat;
    -webkit-mask-position: center;
    mask-position: center;
}

.menuItem.danger .menuIcon {
    background-color: var(--red-400);
}

.sticker.deleting {
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform: scale(0.8) rotate(60deg) !important;
    opacity: 0.8;
}

.sticker.returningFromDelete {
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform: scale(1) rotate(0deg) !important;
}

/* Drop delete animation */
/* Drop delete animation */
.sticker.dropDelete {
    transform: scale(0.8) rotate(60deg) !important;
    opacity: 0;
    transition: opacity 0.3s ease-in;
    pointer-events: none;
}

/* ===== 贴纸实时预览模式 ===== */

/* 预览容器 - 包含输入框和工具栏 */
.stickerPreviewContainer {
    position: fixed;
    z-index: 2000;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-gap-small);
    pointer-events: auto;
}

/* 可编辑的贴纸预览 */
.stickerPreviewInput {
    min-width: 60px;
    padding: var(--spacing-padding-medium) var(--spacing-padding-large);
    background: transparent;
    font-family: var(--font-family);
    font-size: inherit;
    /* Allow inline style to control font size */
    font-weight: 900;
    /* 紧凑行间距 */
    line-height: 0.95;
    /* 紧凑字间距 (0.9 效果) */
    letter-spacing: -0.05em;
    white-space: pre;
    outline: none;
    border: none;
    cursor: text;
    /* Firefox 文本渲染优化 */
    text-rendering: geometricPrecision;
    -moz-text-size-adjust: none;
    -webkit-text-size-adjust: none;
    text-size-adjust: none;
    /* 文字贴纸白色轮廓 - 使用 SVG filter + 浅投影 */
    filter: url(#text-sticker-stroke) drop-shadow(0 4px 8px rgba(0, 0, 0, 0.08));
    /* 允许在输入框中选择文字 */
    user-select: text;
    -webkit-user-select: text;
    /* 字体大小变化动画 */
    transition: font-size var(--transition-smooth);
}

/* 普通字体预览：与最终贴纸保持一致 */
.stickerPreviewInputNormal {
    font-weight: 600;
    letter-spacing: -0.01em;
    line-height: 1;
}

/* 代码字体预览：与最终贴纸保持一致的字重和排版节奏 */
.stickerPreviewInputCode {
    font-weight: 700;
    letter-spacing: -0.01em;
    line-height: 1;
}

/* Firefox 专用样式 */
@supports (-moz-appearance: none) {
    .stickerPreviewInput {
        -webkit-text-stroke: 0.3px currentColor;
        line-height: 0.95;
    }

    .stickerPreviewInputNormal {
        -webkit-text-stroke: 0.2px currentColor;
        line-height: 1;
    }

    .stickerPreviewInputCode {
        -webkit-text-stroke: 0.2px currentColor;
        line-height: 1;
    }
}

/* 占位符样式 */
.stickerPreviewInput:empty::before {
    content: attr(data-placeholder);
    color: var(--color-text-secondary);
    opacity: 0.5;
    pointer-events: none;
}

/* ===== 跟随工具栏 ===== */

.stickerToolbar {
    display: flex;
    flex-direction: column;
    align-items: stretch;
    gap: 6px;
    padding: var(--spacing-padding-small);
    background: var(--color-bg-primary);
    backdrop-filter: blur(24px);
    -webkit-backdrop-filter: blur(24px);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-default);
    box-shadow: var(--shadow-combined);
    pointer-events: auto;
    width: fit-content;
}

.toolbarMainRow {
    display: flex;
    align-items: center;
    gap: 8px;
}

.toolbarFontRow {
    display: flex;
    align-items: center;
    gap: 8px;
}

.toolbarFontLabel {
    font-family: var(--font-family);
    font-size: var(--font-size-small);
    color: var(--color-text-secondary);
    white-space: nowrap;
}

.toolbarFontPresetGroup {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--spacing-padding-extrasmall);
    border-radius: var(--radius-small);
    background: var(--color-bg-secondary);
}

.toolbarFontPresetBtn {
    min-width: 48px;
    height: 26px;
    border: none;
    border-radius: var(--radius-small);
    background: transparent;
    color: var(--color-text-primary);
    font-family: var(--font-family);
    font-size: var(--font-size-small);
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    transition: background var(--transition-fast), color var(--transition-fast);
}

.toolbarFontPresetBtn:hover {
    background: var(--color-bg-primary);
}

.toolbarFontPresetBtn.active {
    background: var(--blue-500);
    color: white;
}

.toolbarFontPreview {
    width: 28px;
    height: 28px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: var(--color-text-primary);
    font-size: var(--font-size-medium);
    font-weight: 700;
}

/* 对齐按钮组 */
.toolbarAlignGroup {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    background: var(--color-bg-secondary);
    border-radius: var(--radius-small);
    padding: var(--spacing-padding-extrasmall);
    position: relative;
    isolation: isolate;
}

.toolbarHighlight {
    position: absolute;
    left: 4px;
    top: 4px;
    bottom: 4px;
    width: calc((100% - 8px) / 3);
    background: var(--color-bg-primary);
    border-radius: 4px;
    transition: transform var(--transition-smooth);
    z-index: 0;
    box-shadow: var(--shadow-small);
}

.toolbarIcon {
    width: 16px;
    height: 16px;
    background-color: currentColor;
    -webkit-mask-size: contain;
    mask-size: contain;
    -webkit-mask-repeat: no-repeat;
    mask-repeat: no-repeat;
    -webkit-mask-position: center;
    mask-position: center;
}

.toolbarAlignBtn {
    width: 32px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    border-radius: var(--radius-small);
    cursor: pointer;
    color: var(--color-text-primary);
    transition: color var(--transition-fast);
    z-index: 1;
    font-size: 14px;
}

.toolbarAlignBtn:hover {
    color: var(--blue-500);
}

/* 字体大小控制 [-][字号][+] */
.toolbarFontSizeControl {
    display: flex;
    align-items: center;
    background: var(--color-bg-secondary);
    border-radius: var(--radius-small);
    padding: var(--spacing-padding-extrasmall);
}

.toolbarFontSizeBtn {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    border-radius: var(--radius-extrasmall);
    cursor: pointer;
    color: var(--color-text-primary);
    font-size: 16px;
    font-weight: 500;
    transition: background var(--transition-fast), color var(--transition-fast);
}

.toolbarFontSizeBtn:hover {
    background: var(--color-bg-primary);
    color: var(--blue-500);
}

.toolbarFontSizeBtn:active {
    background: var(--color-bg-tertiary);
}

.toolbarFontSizeInput {
    width: 40px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    font-family: var(--font-family);
    font-weight: 600;
    color: var(--color-text-primary);
    padding: 0 4px;
    background: transparent;
    border: none;
    outline: none;
    text-align: center;
    /* 移除 spinner */
    -moz-appearance: textfield;
    appearance: textfield;
}

.toolbarFontSizeInput::-webkit-outer-spin-button,
.toolbarFontSizeInput::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

/* 颜色按钮组 */
.toolbarColorGroup {
    display: flex;
    gap: 4px;
}

.toolbarColorBtn {
    width: 24px;
    height: 24px;
    border-radius: var(--radius-large);
    border: 2px solid transparent;
    cursor: pointer;
    transition: transform var(--transition-fast), border-color var(--transition-fast);
}

.toolbarColorBtn:hover {
    transform: scale(1.05);
}

.toolbarColorBtn.active {
    border-color: var(--blue-500);
}

/* 操作按钮 */
.toolbarCancelBtn {
    padding: var(--spacing-padding-small) var(--spacing-padding-medium);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-small);
    color: var(--color-text-primary);
    font-family: var(--font-family);
    font-size: var(--font-size-medium);
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    transition: background var(--transition-medium);
}

.toolbarCancelBtn:hover {
    background: var(--color-bg-tertiary);
}

.toolbarConfirmBtn {
    padding: var(--spacing-padding-small) var(--spacing-padding-medium);
    background: var(--blue-500);
    border: none;
    border-radius: var(--radius-small);
    color: white;
    font-family: var(--font-family);
    font-size: var(--font-size-medium);
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    transition: background var(--transition-medium), opacity var(--transition-medium);
}

.toolbarConfirmBtn:hover {
    background: var(--blue-400);
}

.toolbarConfirmBtn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

/* ----------------------------------------------------------------------------
   Recycle Bin
   ---------------------------------------------------------------------------- */
.recycleBin {
    position: fixed;
    bottom: -220px;
    right: 0;
    width: 200px;
    height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: bottom 0.4s cubic-bezier(0.34, 1.25, 0.64, 1), transform 0.2s ease;
    z-index: 2500;
    /* Below dragging sticker (3000) but above other UI */
    pointer-events: none;
    /* Let events pass through to document for drag logic */
    background: var(--recycle-bin-bg);
    /* Subtle glow backdrop */
    border-radius: 50%;
}

.recycleBin.visible {
    bottom: -90px;
    pointer-events: auto;
}

.recycleIcon {
    width: 160px;
    height: 160px;
    filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
    transition: transform 0.2s ease;
}

/* Hover effect handled by JS drag detection, but we can add scale for visual feedback */
.recycleBin.dragOver .recycleIcon {
    transform: scale(1.1);
}

.recycleBin.active {
    bottom: -90px;
    pointer-events: auto;
    cursor: pointer;
}

.recycleBin.active .recycleIcon {
    cursor: pointer;
    transition: transform 0.2s ease;
}

.recycleBin.active:hover .recycleIcon {
    transform: scale(1.1);
}

.recycleBin.peek {
    bottom: -145px;
    pointer-events: auto;
    /* Allow hovering - show ~55px visible */
}

/* ----------------------------------------------------------------------------
   Recycle Bin Modal
   ---------------------------------------------------------------------------- */


.recycleBinContent {
    width: 90%;
    height: 100%;
    max-width: 1400px;
    display: flex;
    flex-direction: column;
    gap: 24px;
    padding-top: 10vh;
    box-sizing: border-box;
    /* 使用文件夹弹出动画风格 - smoother ease out */
    animation: recycleBinPopIn 0.3s ease-out forwards;
}

.recycleBinHeader {
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: var(--color-text-primary);
    padding: 0;
}

.recycleBinTitle {
    font-size: 32px;
    font-weight: 700;
    margin: 0;
}

/* Close button wrapper - glassmorphism */
/* Header text wrapper for title and subtitle */
.headerTextWrapper {
    display: flex;
    flex-direction: column;
    gap: 4px;
    align-items: flex-start;
}

.recycleBinSubtitle {
    font-size: 14px;
    color: var(--color-text-secondary);
    font-weight: 400;
    opacity: 0.8;
}

.recycleBinCloseWrapper {
    backdrop-filter: blur(40px);
    -webkit-backdrop-filter: blur(40px);
    background: var(--color-bg-primary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-default);
    padding: var(--spacing-border-default);
    cursor: pointer;
    transition: transform var(--transition-normal);
    opacity: 1;
    pointer-events: auto;
    /* Remove default button styles */
    border: 1px solid var(--color-border);
    appearance: none;
    -webkit-appearance: none;
}

.recycleBinCloseWrapper:hover {
    transform: scale(1.05);
}

/* Close button inner container */
.recycleBinCloseInner {
    background: var(--color-bg-secondary);
    border-radius: var(--radius-default-in);
    padding: var(--spacing-gap-small);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-small);
    width: 40px;
    height: 40px;
}

/* Close button icon */
.recycleBinCloseIcon {
    width: 24px;
    height: 24px;
    color: var(--color-text-primary);
}

.recycleBinGrid {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    /* gap: 24px; Removed gap to allow margin collapse animation */
    padding: 0px;
    overflow-y: auto;
}



.recycleBinItem:active {
    cursor: grabbing;
    transition: none;
    /* Instant movement during drag */
}

/* Tooltip on hover handled via subtitle now, removed styles */
.recycleBinItem::after {
    display: none;
}

.recycleBinItem:hover {
    transform: scale(1.02);
    /* No border/shadow changes on hover */
}

.recycleItemPreview {
    max-width: 100%;
    height: auto;
    max-height: 400px;
    object-fit: contain;
    /* Match image sticker style */
    outline: 6px solid var(--color-sticker-stroke);
    outline-offset: 0;
    border-radius: var(--radius-medium);
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.08));
}

.emptyState {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: var(--color-text-secondary);
    gap: 24px;
    padding: 60px 20px;
}

.emptyStateIcon {
    width: 120px;
    height: 120px;
    opacity: 0.6;
    color: var(--color-text-secondary);
}

.emptyStateText {
    font-size: 18px;
    font-weight: 500;
    text-align: center;
    opacity: 0.8;
}

.emptyStateHint {
    font-size: 14px;
    opacity: 0.5;
    text-align: center;
}

/* ===== Swipe Item Wrapper ===== */
@keyframes stickerEnter {
    from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
        filter: blur(4px);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0px);
    }
}

/* Update Modal Animation */
/* ... (unchanged modal styles) ... */

/* Update Item Animation for staggered entry */
.recycleBinItemWrapper {
    position: relative;
    width: 100%;
    max-width: 600px;
    border-radius: var(--radius-medium);
    margin-bottom: 24px;

    /* Entrance Animation - Refined for smoothness */
    opacity: 0;
    /* Uses a confident ease-out curve */
    animation: stickerEnter 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
}

/* ... existing styles ... */

/* Update Item Animation for staggered entry */
.recycleBinItem {
    position: relative;
    /* Remove card styling to look like raw sticker */
    background: transparent;
    border: none;
    border-radius: 0;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    cursor: grab;

    /* Base state for entrance animation - REMOVED to avoid conflict with drag transform */
    /* opacity: 0; */
    /* animation: fadeInUp 0.4s cubic-bezier(0.34, 1.25, 0.64, 1) forwards; */

    transition: transform 0.2s ease;
    /* Default transition, override during drag */
    width: 100%;
    /* Max width constraint is now on the wrapper */
    max-width: 100%;
    z-index: 2;
    /* Above background */
    touch-action: pan-y;
    /* Allow vertical scroll, handle horizontal in JS */
}

/* Swipe background layer */
.swipeBackground {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 24px;
    border-radius: var(--radius-medium);
    z-index: 1;
    transition: opacity 0.15s ease;
}

.swipeBackground.delete {
    background: linear-gradient(90deg, rgba(255, 59, 48, 0.9) 0%, rgba(255, 59, 48, 0.6) 50%, transparent 100%);
}

.swipeBackground.restore {
    background: linear-gradient(270deg, rgba(52, 199, 89, 0.9) 0%, rgba(52, 199, 89, 0.6) 50%, transparent 100%);
}

/* Threshold reached state - enhanced visual feedback */
.swipeBackground.delete.threshold {
    background: linear-gradient(90deg, rgba(255, 59, 48, 1) 0%, rgba(255, 59, 48, 0.8) 60%, transparent 100%);
}

.swipeBackground.restore.threshold {
    background: linear-gradient(270deg, rgba(52, 199, 89, 1) 0%, rgba(52, 199, 89, 0.8) 60%, transparent 100%);
}

/* Swipe action content (icons and text) */
.swipeActionContent {
    display: flex;
    align-items: center;
    gap: 8px;
    color: white;
    font-weight: 600;
    font-size: 14px;
    transition: transform 0.2s ease, opacity 0.2s ease;
}

.swipeActionContent svg {
    width: 24px;
    height: 24px;
    transition: transform 0.2s ease;
}

.swipeActionIcon {
    width: 24px;
    height: 24px;
    filter: brightness(0) invert(1);
    /* Make icon white */
    transition: transform 0.2s ease;
}

/* Icon scale up when threshold reached */
.swipeBackground.threshold .swipeActionContent svg,
.swipeBackground.threshold .swipeActionContent .swipeActionIcon {
    transform: scale(1.2);
}

/* ===== Delete/Restore Animations ===== */
.recycleBinItem.restoring {
    transition: transform 0.4s cubic-bezier(0.34, 1.25, 0.64, 1), opacity 0.4s ease !important;
    opacity: 0;
    pointer-events: none;
}

.recycleBinItem.permanentlyDeleting {
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease !important;
    opacity: 0;
    pointer-events: none;
}

/* Spring-back animation for when swipe doesn't reach threshold */
.recycleBinItem.springBack {
    transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
}

/* ===== Modal Closing Animation ===== */
.recycleBinModal.closing .recycleBinContent {
    animation: recycleBinPopOut 0.25s cubic-bezier(0.4, 0, 1, 1) forwards;
}

/* ===== Keyframe Animations ===== */
/* ===== Keyframe Animations ===== */
@keyframes recycleBinPopIn {
    from {
        opacity: 0;
        transform: scale(0.95);
        filter: blur(10px);
    }

    to {
        opacity: 1;
        transform: scale(1);
        filter: blur(0px);
    }
}

@keyframes recycleBinPopOut {
    from {
        opacity: 1;
        transform: scale(1);
        filter: blur(0px);
    }

    to {
        opacity: 0;
        transform: scale(0.95);
        filter: blur(10px);
    }
}

@keyframes restoreSlideOut {
    0% {
        opacity: 1;
        transform: translateX(0) scale(1);
    }

    100% {
        opacity: 0;
        transform: translateX(-100px) scale(0.9);
    }
}

@keyframes deleteDissolve {
    0% {
        opacity: 1;
        transform: translateX(0) scale(1);
    }

    100% {
        opacity: 0;
        transform: translateX(80px) scale(0.8);
    }
}



@keyframes modalFadeIn {
    from {
        opacity: 0;
        backdrop-filter: blur(0px);
        -webkit-backdrop-filter: blur(0px);
    }

    to {
        opacity: 1;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
    }
}

@keyframes modalFadeOut {
    from {
        opacity: 1;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
    }

    to {
        opacity: 0;
        backdrop-filter: blur(0px);
        -webkit-backdrop-filter: blur(0px);
    }
}

/* Update Modal Animation */
.recycleBinModal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 4000;
    display: flex;
    align-items: center;
    justify-content: center;

    /* Theme-aware background */
    background: var(--recycle-bin-modal-bg);

    /* Blur effect - Initial State */
    backdrop-filter: blur(0px);
    -webkit-backdrop-filter: blur(0px);

    opacity: 0;
    pointer-events: none;
}

.recycleBinModal.open {
    opacity: 1;
    pointer-events: auto;
    /* Use animation for more control over blur interpolation if needed, or stick to transition */
    animation: modalFadeIn 0.3s ease forwards;
}

.recycleBinModal.closing {
    /* Ensure opacity fades out when closing */
    opacity: 1;
    backdrop-filter: blur(20px);
    pointer-events: none;
    animation: modalFadeOut 0.25s ease forwards;
}

/* Update Item Animation for staggered entry */
/* Update Item Animation for staggered entry */
.recycleBinItem {
    position: relative;
    /* Remove card styling to look like raw sticker */
    background: transparent;
    border: none;
    border-radius: 0;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    cursor: grab;

    transition: transform 0.2s ease;
    /* Default transition, override during drag */
    width: 100%;
    /* Max width constraint is now on the wrapper */
    max-width: 100%;
    z-index: 2;
    /* Above background */
    touch-action: pan-y;
    /* Allow vertical scroll, handle horizontal in JS */
}
